{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://physics91.com/agents-context-preserver/schemas/hook-output.schema.json",
  "title": "HookOutput",
  "description": "Output structures for AGENTS Context Preserver plugin hooks",
  "type": "object",
  "required": ["success", "timestamp"],
  "properties": {
    "success": {
      "type": "boolean",
      "description": "Whether the hook executed successfully"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO8601 timestamp when the hook completed",
      "format": "date-time",
      "examples": ["2024-01-15T10:30:00Z"]
    },
    "error": {
      "type": "object",
      "description": "Error information if the hook failed",
      "properties": {
        "code": {
          "type": "string",
          "description": "Error code for categorization",
          "maxLength": 100,
          "examples": ["TIMEOUT", "VALIDATION_ERROR", "IO_ERROR"]
        },
        "message": {
          "type": "string",
          "description": "Human-readable error message",
          "maxLength": 1000,
          "examples": ["Hook execution timed out after 5000ms"]
        },
        "stack": {
          "type": "string",
          "description": "Stack trace if available",
          "maxLength": 5000
        }
      },
      "required": ["code", "message"],
      "additionalProperties": false
    },
    "context_updates": {
      "type": "object",
      "description": "Updates to apply to the context state",
      "properties": {
        "task_context": {
          "type": "object",
          "description": "Updates to task context",
          "properties": {
            "current_objective": {
              "type": "string",
              "maxLength": 1000
            },
            "progress_summary": {
              "type": "string",
              "maxLength": 2000
            },
            "add_completed_steps": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "maxItems": 10
            },
            "add_in_progress_steps": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "maxItems": 5
            },
            "add_pending_steps": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "maxItems": 10
            },
            "remove_steps": {
              "type": "array",
              "description": "Steps to remove by content match",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "maxItems": 10
            },
            "add_decisions": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["decision", "rationale"],
                "properties": {
                  "decision": {
                    "type": "string",
                    "maxLength": 500
                  },
                  "rationale": {
                    "type": "string",
                    "maxLength": 1000
                  }
                },
                "additionalProperties": false
              },
              "maxItems": 5
            }
          },
          "additionalProperties": false
        },
        "working_context": {
          "type": "object",
          "description": "Updates to working context",
          "properties": {
            "add_active_files": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "maxItems": 10
            },
            "remove_active_files": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "maxItems": 10
            },
            "add_modified_files": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "maxItems": 20
            },
            "set_key_variables": {
              "type": "object",
              "description": "Key-value pairs to set or update",
              "additionalProperties": true
            },
            "remove_key_variables": {
              "type": "array",
              "description": "Variable names to remove",
              "items": {
                "type": "string",
                "maxLength": 100
              },
              "maxItems": 20
            },
            "add_errors": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 1000
              },
              "maxItems": 3
            },
            "clear_errors": {
              "type": "boolean",
              "description": "Whether to clear all recent errors",
              "default": false
            }
          },
          "additionalProperties": false
        },
        "metadata": {
          "type": "object",
          "description": "Updates to metadata",
          "properties": {
            "increment_compaction_count": {
              "type": "boolean",
              "default": false
            },
            "increment_restoration_count": {
              "type": "boolean",
              "default": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "actions": {
      "type": "array",
      "description": "Additional actions to perform after hook completion",
      "items": {
        "$ref": "#/definitions/HookAction"
      },
      "maxItems": 10
    },
    "metrics": {
      "type": "object",
      "description": "Metrics collected during hook execution",
      "properties": {
        "execution_time_ms": {
          "type": "integer",
          "description": "Hook execution time in milliseconds",
          "minimum": 0
        },
        "memory_used_bytes": {
          "type": "integer",
          "description": "Memory used during hook execution",
          "minimum": 0
        },
        "custom": {
          "type": "object",
          "description": "Custom metrics",
          "additionalProperties": {
            "type": "number"
          }
        }
      },
      "additionalProperties": false
    },
    "logs": {
      "type": "array",
      "description": "Log messages generated during hook execution",
      "items": {
        "$ref": "#/definitions/LogEntry"
      },
      "maxItems": 100
    }
  },
  "definitions": {
    "HookAction": {
      "type": "object",
      "description": "An action to perform after hook completion",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of action to perform",
          "enum": [
            "save_context",
            "create_backup",
            "notify_user",
            "trigger_compaction",
            "reload_agents_md",
            "custom"
          ],
          "examples": ["save_context", "create_backup"]
        },
        "priority": {
          "type": "integer",
          "description": "Priority for action execution (lower = higher priority)",
          "minimum": 0,
          "maximum": 100,
          "default": 50
        },
        "params": {
          "type": "object",
          "description": "Parameters for the action",
          "additionalProperties": true,
          "examples": [{"message": "Context saved successfully"}, {"backup_name": "pre-compaction"}]
        }
      },
      "additionalProperties": false
    },
    "LogEntry": {
      "type": "object",
      "description": "A log entry from hook execution",
      "required": ["level", "message", "timestamp"],
      "properties": {
        "level": {
          "type": "string",
          "description": "Log level",
          "enum": ["debug", "info", "warn", "error"],
          "examples": ["info", "error"]
        },
        "message": {
          "type": "string",
          "description": "Log message",
          "maxLength": 1000,
          "examples": ["Processing tool output", "Failed to read file"]
        },
        "timestamp": {
          "type": "string",
          "description": "ISO8601 timestamp of the log entry",
          "format": "date-time"
        },
        "data": {
          "type": "object",
          "description": "Additional structured data",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
